<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android xml 中 drawable、color 的混用与 selector | Xiao's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-143241641-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android xml 中 drawable、color 的混用与 selector</h1><a id="logo" href="/.">Xiao's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android xml 中 drawable、color 的混用与 selector</h1><div class="post-meta">2020-04-24</div><div class="post-content"><p>平时在安卓项目中需要编写 xml 布局时，我都习惯需要接收 <code>drawable</code> 资源的属性中（ 如 <code>android:background</code> ）可以按需传入 <code>drawable</code> 资源 （ 如 <code>@drawable/layout_bg</code> ） 和 <code>color</code> 资源 （ 如 <code>@color/layout_bg_color</code>），并且默认在 xml 资源中 color 资源是可以代替 drawable 使用的。</p>
<p>但是最近在布局中使用 <code>selector</code> 时，发现表现并不如自己所料。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>需求是在一排 tab 中，被选中的 tab 使用一种背景色和文字颜色，未被选中的其它所有 tab 都使用另一种背景色和文字颜色。在这样的需求下，使用 <code>selector</code> ，根据 <code>state_selected</code> 属性来区分颜色就很方便了。</p>
<p>color/tab_color.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;#777777&quot;</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;#555555&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>color/tab_color.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;#555555&quot;</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;#777777&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>layout/tab.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">&lt;android.support.constraint.ConstraintLayout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:background=&quot;@color/tab_bg&quot;</span><br><span class="line">    android:padding=&quot;14dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;@color/tab_color&quot;</span><br><span class="line">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintRight_toRightOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在代码中使用这个布局，并且设置好点击事件后，运行代码，却得到错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: Unable to start activity ComponentInfo&#123;com.example.myapplication&#x2F;com.example.myapplication.MainActivity&#125;: android.view.InflateException: Binary XML file line #2: Binary XML file line #2: Error inflating class android.support.constraint.ConstraintLayout</span><br><span class="line">        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2778)</span><br><span class="line">        at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2856)</span><br><span class="line">        at android.app.ActivityThread.-wrap11(Unknown Source:0)</span><br><span class="line">        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1589)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:106)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:164)</span><br><span class="line">        at android.app.ActivityThread.main(ActivityThread.java:6494)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:438)</span><br><span class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:807)</span><br><span class="line">     Caused by: android.view.InflateException: Binary XML file line #2: Binary XML file line #2: Error inflating class android.support.constraint.ConstraintLayout</span><br><span class="line">     Caused by: android.view.InflateException: Binary XML file line #2: Error inflating class android.support.constraint.ConstraintLayout</span><br><span class="line">     Caused by: java.lang.reflect.InvocationTargetException</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance0(Native Method)</span><br><span class="line">        at java.lang.reflect.Constructor.newInstance(Constructor.java:334)</span><br><span class="line">        at android.view.LayoutInflater.createView(LayoutInflater.java:647)</span><br><span class="line">        at android.view.LayoutInflater.createViewFromTag(LayoutInflater.java:790)</span><br><span class="line">        at android.view.LayoutInflater.createViewFromTag(LayoutInflater.java:730)</span><br><span class="line">        at android.view.LayoutInflater.inflate(LayoutInflater.java:492)</span><br><span class="line">        at android.view.LayoutInflater.inflate(LayoutInflater.java:423)</span><br><span class="line">        ...</span><br><span class="line">    Caused by: android.content.res.Resources$NotFoundException: Drawable com.example.myapplication:color&#x2F;tab_bg with resource ID #0x7f040055</span><br><span class="line">     Caused by: android.content.res.Resources$NotFoundException: File res&#x2F;color&#x2F;tab_bg.xml from drawable resource ID #0x7f040055</span><br><span class="line">        at android.content.res.ResourcesImpl.loadDrawableForCookie(ResourcesImpl.java:820)</span><br><span class="line">        at android.content.res.ResourcesImpl.loadDrawable(ResourcesImpl.java:630)</span><br><span class="line">        at android.content.res.Resources.loadDrawable(Resources.java:886)</span><br><span class="line">        at android.content.res.TypedArray.getDrawableForDensity(TypedArray.java:953)</span><br><span class="line">        at android.content.res.TypedArray.getDrawable(TypedArray.java:928)</span><br><span class="line">        ...</span><br><span class="line">    Caused by: org.xmlpull.v1.XmlPullParserException: Binary XML file line #3: &lt;item&gt; tag requires a &#39;drawable&#39; attribute or child tag defining a drawable</span><br><span class="line">        at android.graphics.drawable.StateListDrawable.inflateChildElements(StateListDrawable.java:189)</span><br><span class="line">        at android.graphics.drawable.StateListDrawable.inflate(StateListDrawable.java:122)</span><br><span class="line">        at android.graphics.drawable.DrawableInflater.inflateFromXmlForDensity(DrawableInflater.java:142)</span><br></pre></td></tr></table></figure>

<h2 id="错误分析"><a href="#错误分析" class="headerlink" title="错误分析"></a>错误分析</h2><p>在异常信息中，可以得知 tab 的根布局就渲染失败了，其原因是为其设置的 background 资源 <code>@color/tab_bg</code> 解析失败，需要为其设置 <code>drawable</code> 属性，或者需要有定义了 drawable 的子 tag。</p>
<p>进入源码中仔细查看，一个 <code>selector</code> 资源对应会生成一个 <code>StateListDrawable</code> ，其中的 <code>inflateChildElements</code> 方法用来解析 xml 中的每一个 <code>item</code> ，其源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inflateChildElements</span><span class="params">(Resources r, XmlPullParser parser, AttributeSet attrs,</span></span></span><br><span class="line"><span class="function"><span class="params">        Theme theme)</span> <span class="keyword">throws</span> XmlPullParserException, IOException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> StateListState state = mStateListState;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> innerDepth = parser.getDepth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">int</span> depth;</span><br><span class="line">    <span class="keyword">while</span> ((type = parser.next()) != XmlPullParser.END_DOCUMENT</span><br><span class="line">            &amp;&amp; ((depth = parser.getDepth()) &gt;= innerDepth</span><br><span class="line">            || type != XmlPullParser.END_TAG)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (type != XmlPullParser.START_TAG) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (depth &gt; innerDepth || !parser.getName().equals(<span class="string">&quot;item&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// This allows state list drawable item elements to be themed at</span></span><br><span class="line">        <span class="comment">// inflation time but does NOT make them work for Zygote preload.</span></span><br><span class="line">        <span class="keyword">final</span> TypedArray a = obtainAttributes(r, theme, attrs,</span><br><span class="line">                R.styleable.StateListDrawableItem);</span><br><span class="line">        Drawable dr = a.getDrawable(R.styleable.StateListDrawableItem_drawable);</span><br><span class="line">        a.recycle();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span>[] states = extractStateSet(attrs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Loading child elements modifies the state of the AttributeSet&#x27;s</span></span><br><span class="line">        <span class="comment">// underlying parser, so it needs to happen after obtaining</span></span><br><span class="line">        <span class="comment">// attributes and extracting states.</span></span><br><span class="line">        <span class="keyword">if</span> (dr == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> ((type = parser.next()) == XmlPullParser.TEXT) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (type != XmlPullParser.START_TAG) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> XmlPullParserException(</span><br><span class="line">                        parser.getPositionDescription()</span><br><span class="line">                                + <span class="string">&quot;: &lt;item&gt; tag requires a &#x27;drawable&#x27; attribute or &quot;</span></span><br><span class="line">                                + <span class="string">&quot;child tag defining a drawable&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            dr = Drawable.createFromXmlInner(r, parser, attrs, theme);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        state.addStateSet(states, dr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>parser</code> 传入的时候，便已经处于第一个 <code>selector</code> 的起始标记之后，经过 14 行的的循环语句后， <code>parser</code> 位于第一个 <code>item</code> 的起始标记之前，22 行里尝试从 <code>item</code> 项中获取 <code>drawable</code> 属性，以其中的值获取一个 <code>Drawable</code> 资源。</p>
<p>如果上述获取资源失败，在 30 行就会进入内部解析流程，将 <code>parser</code> 定位到内部第一个起始标记之前，然后把这个 <code>parser</code> 传递给 <code>Drawable.createFromXmlInner</code> ，解析出一个合适的 <code>drawable</code> 作为当前状态的图片资源。</p>
<p>在我刚刚所写的 <code>selector</code> 资源中，我简单地认为作为背景图片资源的 selector 也可以跟颜色资源一样，只为其写了 <code>android:color</code> 属性，恰好不满足源码中对于资源定义的要求，解析失败就是必然的了。</p>
<h2 id="普通-color-可以替代-drawable-的原因"><a href="#普通-color-可以替代-drawable-的原因" class="headerlink" title="普通 color 可以替代 drawable 的原因"></a>普通 color 可以替代 drawable 的原因</h2><p>在知道了作为 <code>color</code> 的 <code>selector</code> 资源不能代替 <code>drawable</code> 后，我决定再探究一下为什么普通的颜色资源可以代替图片使用。其解析入口正是上面分析中提到的 <code>Drawable.createFromXmlInner</code> ，而内部调用到最深处使用的是 <code>android.graphics.drawable.DrawableInflater#inflateFromXmlForDensity</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function">Drawable <span class="title">inflateFromXmlForDensity</span><span class="params">(<span class="meta">@NonNull</span> String name, <span class="meta">@NonNull</span> XmlPullParser parser,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@NonNull</span> AttributeSet attrs, <span class="keyword">int</span> density, <span class="meta">@Nullable</span> Theme theme)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> XmlPullParserException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// Inner classes must be referenced as Outer$Inner, but XML tag names</span></span><br><span class="line">    <span class="comment">// can&#x27;t contain $, so the &lt;drawable&gt; tag allows developers to specify</span></span><br><span class="line">    <span class="comment">// the class in an attribute. We&#x27;ll still run it through inflateFromTag</span></span><br><span class="line">    <span class="comment">// to stay consistent with how LayoutInflater works.</span></span><br><span class="line">    <span class="keyword">if</span> (name.equals(<span class="string">&quot;drawable&quot;</span>)) &#123;</span><br><span class="line">        name = attrs.getAttributeValue(<span class="keyword">null</span>, <span class="string">&quot;class&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InflateException(<span class="string">&quot;&lt;drawable&gt; tag must specify class attribute&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Drawable drawable = inflateFromTag(name);</span><br><span class="line">    <span class="keyword">if</span> (drawable == <span class="keyword">null</span>) &#123;</span><br><span class="line">        drawable = inflateFromClass(name);</span><br><span class="line">    &#125;</span><br><span class="line">    drawable.setSrcDensityOverride(density);</span><br><span class="line">    drawable.inflate(mRes, parser, attrs, theme);</span><br><span class="line">    <span class="keyword">return</span> drawable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Drawable <span class="title">inflateFromTag</span><span class="params">(<span class="meta">@NonNull</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;selector&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> StateListDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;animated-selector&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnimatedStateListDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;level-list&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LevelListDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;layer-list&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LayerDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;transition&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TransitionDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ripple&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RippleDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;adaptive-icon&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AdaptiveIconDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;color&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ColorDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;shape&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> GradientDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;vector&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> VectorDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;animated-vector&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnimatedVectorDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;scale&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ScaleDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;clip&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ClipDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;rotate&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RotateDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;animated-rotate&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnimatedRotateDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;animation-list&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnimationDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;inset&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> InsetDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;bitmap&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BitmapDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;nine-patch&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NinePatchDrawable();</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;animated-image&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnimatedImageDrawable();</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里就很简单了，识别到 tag 是 <code>color</code> 之后，系统自动创建一个 <code>ColorDrawable</code> ，相当于一个方便我们使用的系统适配；而 <code>selector</code> 对应的 <code>StateListDrawable</code> 的内部处理中，没有做类似的适配；对应于 color 中的 selector ，系统为我们创建的其实是 <code>ColorStateList</code> ， 并不属于一种 <code>Drawable</code> 。在这种情况下，就不能想当然地认为颜色可以作为图片使用了。</p>
<h2 id="问题修复"><a href="#问题修复" class="headerlink" title="问题修复"></a>问题修复</h2><p>知道错误原因之后修改就方便了，只需要按照其要求的规范写 <code>selector</code> 就好：</p>
<p>drawable/tab_bg.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;#777777&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;#555555&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只是失去了普通颜色资源的既可用在 color 属性中，又可用在 drawable 属性中的便利性了。</p>
<p>又或者写出一种会被喷代码质量差的资源：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:color</span>=<span class="string">&quot;#777777&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;#777777&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;#555555&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;#555555&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>本文标题：</span>Android xml 中 drawable、color 的混用与 selector</p><p><span>文章作者：</span>Xiao</p><p><span>发布时间：</span>2020-04-24</p><p><span>最后更新：</span>2021-12-27</p><p><span>原始链接：</span><a href="/blog/android-drawable-color-selector/">https://blog.xiaozk.site/blog/android-drawable-color-selector/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://blog.xiaozk.site/blog/android-drawable-color-selector/"></i></span></p><p><span>版权声明：</span><a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议（CC-BY-NC-4.0）</a>进行许可。</a></p></div><br><div class="tags"><a href="/tags/Android/"><i class="fa fa-tag"></i>Android</a><a href="/tags/xml/"><i class="fa fa-tag"></i>xml</a><a href="/tags/layout/"><i class="fa fa-tag"></i>layout</a><a href="/tags/drawable/"><i class="fa fa-tag"></i>drawable</a><a href="/tags/color/"><i class="fa fa-tag"></i>color</a><a href="/tags/selector/"><i class="fa fa-tag"></i>selector</a></div><div class="post-nav"><a class="pre" href="/blog/recycler-animator-click/">RecyclerView 的 item 在动画过程中的点击事件</a><a class="next" href="/blog/kotlin-lambda-param/">kotlin 中传入形参、返回不匹配的 lambda 表达式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://blog.xiaozk.site"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/kotlin/" style="font-size: 15px;">kotlin</a> <a href="/tags/forEach/" style="font-size: 15px;">forEach</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/stream/" style="font-size: 15px;">stream</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/ItemTouchHelper/" style="font-size: 15px;">ItemTouchHelper</a> <a href="/tags/RecyclerView/" style="font-size: 15px;">RecyclerView</a> <a href="/tags/Callback/" style="font-size: 15px;">Callback</a> <a href="/tags/Unittest/" style="font-size: 15px;">Unittest</a> <a href="/tags/Powermock/" style="font-size: 15px;">Powermock</a> <a href="/tags/mock-rule/" style="font-size: 15px;">mock rule</a> <a href="/tags/RuleChain/" style="font-size: 15px;">RuleChain</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Constructor/" style="font-size: 15px;">Constructor</a> <a href="/tags/MVVM/" style="font-size: 15px;">MVVM</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/xml/" style="font-size: 15px;">xml</a> <a href="/tags/layout/" style="font-size: 15px;">layout</a> <a href="/tags/drawable/" style="font-size: 15px;">drawable</a> <a href="/tags/color/" style="font-size: 15px;">color</a> <a href="/tags/selector/" style="font-size: 15px;">selector</a> <a href="/tags/ItemAnimator/" style="font-size: 15px;">ItemAnimator</a> <a href="/tags/coroutine/" style="font-size: 15px;">coroutine</a> <a href="/tags/%E5%AE%89%E5%8D%93/" style="font-size: 15px;">安卓</a> <a href="/tags/%E5%8D%8F%E7%A8%8B/" style="font-size: 15px;">协程</a> <a href="/tags/ItemDecoration/" style="font-size: 15px;">ItemDecoration</a> <a href="/tags/Animation/" style="font-size: 15px;">Animation</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/coroutine-task/">使用协程组合管理业务逻辑</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/recycler-animate-decoration/">RecyclerView 中为 ItemDecoration 应用动画</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/recycler-animator-click/">RecyclerView 的 item 在动画过程中的点击事件</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-drawable-color-selector/">Android xml 中 drawable、color 的混用与 selector</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/kotlin-lambda-param/">kotlin 中传入形参、返回不匹配的 lambda 表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/thoughts-of-android-mvvm/">Android 项目中使用 MVVM 模式的一些思考</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/java-override-constructor/">java 构造方法的重载</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-test-rule-order/">Android 使用Powermock的单元测试的 Rule 顺序</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/item-touch-helper-section/">ItemTouchHelper实现拖动分组与定制</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/kotlin-loop-break/">Kotlin 中 forEach 的中断</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">Xiao's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>