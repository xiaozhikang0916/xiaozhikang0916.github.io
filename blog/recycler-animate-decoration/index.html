<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta name="referrer" content="no-referrer"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>RecyclerView 中为 ItemDecoration 应用动画 | Xiao's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-143241641-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">RecyclerView 中为 ItemDecoration 应用动画</h1><a id="logo" href="/.">Xiao's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">RecyclerView 中为 ItemDecoration 应用动画</h1><div class="post-meta">2021-03-09</div><div class="post-content"><p>在 <code>RecyclerView</code> 中，使用 <code>ItemDecoration</code> 来添加分割线或者侧边装饰条是十分常用的操作，可以实现分割线、装饰条的实现与列表元素解耦，和跨列表元素之间的装饰交互。</p>
<p>但是， <code>ItemDecoration</code> 的画面显示实现是需要开发者自己覆盖 <code>onDraw</code> 方法，在卡片之外自行将画面元素绘制上去。因其绘制过程与卡片本身没有关系，可以想象到的是，卡片在动画过程中不会自动地影响到 <code>ItemDecoration</code> 中所绘制的元素，需要开发者进行额外的适配工作。</p>
<h2 id="贯穿分割线的绘制"><a href="#贯穿分割线的绘制" class="headerlink" title="贯穿分割线的绘制"></a>贯穿分割线的绘制</h2><p><code>ItemDecoration</code> 最常见的一个用法是用来绘制卡片之间的贯穿型分割线。实现方法也非常简单，在需要绘制分割线的两张卡片之间，使用 <code>getItemOffsets</code> 方法留出足够的空间， <code>onDraw</code> 时在前一个卡片的 <code>bottom</code> 和后一个卡片的 <code>top</code> 之间绘制分割线即可。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">    outRect.bottom = DIVIDER_HEIGHT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onDraw(c, parent, state)</span><br><span class="line">    (<span class="number">0</span> until parent.childCount - <span class="number">1</span>).forEach &#123; it -&gt;</span><br><span class="line">        <span class="keyword">val</span> rect = RectF(</span><br><span class="line">            <span class="number">0f</span>,</span><br><span class="line">            it.bottom.toFloat(),</span><br><span class="line">            parent.width,</span><br><span class="line">            it.bottom.toFloat() + DIVIDER_HEIGHT</span><br><span class="line">        )</span><br><span class="line">        c.drawRect(rect, DIVIDER_PAINT)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此实现在静态展现时还尚可，但是如果 <code>RecyclerView</code> 使用了默认的元素动画，在元素添加、删除等有位移动画时，分割线并不会随着动画一起移动，而是提前直接在位移结束位置上绘制出来，等着卡片元素到位。</p>
<h3 id="RecyclerView-元素动画的实现"><a href="#RecyclerView-元素动画的实现" class="headerlink" title="RecyclerView 元素动画的实现"></a>RecyclerView 元素动画的实现</h3><p>为了解决这个问题，首先需要知道元素动画是如何实现的。</p>
<p>在使用默认动画的情况下，添加、删除一些卡片后，其余没有发生变化，但是需要移动位置的卡片是通过 <code>SimpleItemAnimator</code> 里的 <code>animatePersistence</code> 进行的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">animatePersistence</span><span class="params">(<span class="meta">@NonNull</span> RecyclerView.ViewHolder viewHolder,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@NonNull</span> ItemHolderInfo preInfo, <span class="meta">@NonNull</span> ItemHolderInfo postInfo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (preInfo.left != postInfo.left || preInfo.top != postInfo.top) &#123;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;PERSISTENT: &quot;</span> + viewHolder</span><br><span class="line">                    + <span class="string">&quot; with view &quot;</span> + viewHolder.itemView);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> animateMove(viewHolder,</span><br><span class="line">                preInfo.left, preInfo.top, postInfo.left, postInfo.top);</span><br><span class="line">    &#125;</span><br><span class="line">    dispatchMoveFinished(viewHolder);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中调用的是 <code>DefaultItemAnimator</code> 里的 <code>animateMove</code> 方法，最终由 <code>animateMoveImpl</code> 执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">animateMove</span><span class="params">(<span class="keyword">final</span> RecyclerView.ViewHolder holder, <span class="keyword">int</span> fromX, <span class="keyword">int</span> fromY,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> toX, <span class="keyword">int</span> toY)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> View view = holder.itemView;</span><br><span class="line">    fromX += (<span class="keyword">int</span>) holder.itemView.getTranslationX();</span><br><span class="line">    fromY += (<span class="keyword">int</span>) holder.itemView.getTranslationY();</span><br><span class="line">    resetAnimation(holder);</span><br><span class="line">    <span class="keyword">int</span> deltaX = toX - fromX;</span><br><span class="line">    <span class="keyword">int</span> deltaY = toY - fromY;</span><br><span class="line">    <span class="keyword">if</span> (deltaX == <span class="number">0</span> &amp;&amp; deltaY == <span class="number">0</span>) &#123;</span><br><span class="line">        dispatchMoveFinished(holder);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (deltaX != <span class="number">0</span>) &#123;</span><br><span class="line">        view.setTranslationX(-deltaX);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (deltaY != <span class="number">0</span>) &#123;</span><br><span class="line">        view.setTranslationY(-deltaY);</span><br><span class="line">    &#125;</span><br><span class="line">    mPendingMoves.add(<span class="keyword">new</span> MoveInfo(holder, fromX, fromY, toX, toY));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">animateMoveImpl</span><span class="params">(<span class="keyword">final</span> RecyclerView.ViewHolder holder, <span class="keyword">int</span> fromX, <span class="keyword">int</span> fromY, <span class="keyword">int</span> toX, <span class="keyword">int</span> toY)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> View view = holder.itemView;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> deltaX = toX - fromX;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> deltaY = toY - fromY;</span><br><span class="line">    <span class="keyword">if</span> (deltaX != <span class="number">0</span>) &#123;</span><br><span class="line">        view.animate().translationX(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (deltaY != <span class="number">0</span>) &#123;</span><br><span class="line">        view.animate().translationY(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> make EndActions end listeners instead, since end actions aren&#x27;t called when</span></span><br><span class="line">    <span class="comment">// vpas are canceled (and can&#x27;t end them. why?)</span></span><br><span class="line">    <span class="comment">// need listener functionality in VPACompat for this. Ick.</span></span><br><span class="line">    <span class="keyword">final</span> ViewPropertyAnimator animation = view.animate();</span><br><span class="line">    mMoveAnimations.add(holder);</span><br><span class="line">    animation.setDuration(getMoveDuration()).setListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animator)</span> </span>&#123;</span><br><span class="line">            dispatchMoveStarting(holder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animator)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (deltaX != <span class="number">0</span>) &#123;</span><br><span class="line">                view.setTranslationX(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (deltaY != <span class="number">0</span>) &#123;</span><br><span class="line">                view.setTranslationY(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animator)</span> </span>&#123;</span><br><span class="line">            animation.setListener(<span class="keyword">null</span>);</span><br><span class="line">            dispatchMoveFinished(holder);</span><br><span class="line">            mMoveAnimations.remove(holder);</span><br><span class="line">            dispatchFinishedWhenDone();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出来，位移动画的实现是通过修改其 <code>translationX</code> <code>translationY</code> 属性执行的。修改 <code>translation</code> 实现位移也是动画实现的常用方案，那么只要在绘制分割线的时候将 <code>translation</code> 属性也纳入计算即可。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">    outRect.bottom = DIVIDER_HEIGHT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onDraw(c, parent, state)</span><br><span class="line">    (<span class="number">0</span> until parent.childCount - <span class="number">1</span>).forEach &#123; it -&gt;</span><br><span class="line">        <span class="keyword">val</span> rect = RectF(</span><br><span class="line">            <span class="number">0f</span>,</span><br><span class="line">            it.bottom.toFloat() + it.translationY,</span><br><span class="line">            parent.width,</span><br><span class="line">            it.bottom.toFloat() + DIVIDER_HEIGHT + it.translationY</span><br><span class="line">        )</span><br><span class="line">        c.drawRect(rect, DIVIDER_PAINT)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，分割线便能在列表元素进行位移动画过程中跟随一起移动了。</p>
<h2 id="侧边装饰条的实现"><a href="#侧边装饰条的实现" class="headerlink" title="侧边装饰条的实现"></a>侧边装饰条的实现</h2><p>在项目中，使用 <code>ItemDecoration</code> 实现列表的侧边装饰条也是很常见的操作。例如在卡片侧面绘制一条竖线，用来显示时间线效果。在接下来的讨论中，我们简单考虑这样一个需求：</p>
<ul>
<li>数据结构中带有颜色字段，需要在卡片左侧绘制对应颜色的方块；</li>
<li>方块的绘制需要使用 <code>ItemDecoration</code> 实现；</li>
<li>方块需要跟随卡片进行位移、显隐动画。</li>
</ul>
<h3 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h3><p>基于上一环节的成果，很快就能写出这样一段代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Data</span></span>(</span><br><span class="line">    <span class="keyword">val</span> content: String,</span><br><span class="line">    <span class="meta">@ColorInt</span> <span class="keyword">val</span> color: <span class="built_in">Int</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Data(content=<span class="variable">$content</span>, color=#<span class="subst">$&#123;String.format(<span class="string">&quot;%06x&quot;</span>, color)&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SideDecoration</span></span>(context: Context, <span class="keyword">private</span> <span class="keyword">val</span> dataGetter: ((<span class="built_in">Int</span>) -&gt; Data?)) : RecyclerView.ItemDecoration() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paint = Paint()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> padding = context.resources.getDimensionPixelSize(R.dimen.item_side_padding)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(c, parent, state)</span><br><span class="line">        parent.children.map &#123;</span><br><span class="line">            it to parent.getChildAdapterPosition(it)</span><br><span class="line">        &#125;.map &#123; (view, index) -&gt;</span><br><span class="line">            <span class="keyword">val</span> <span class="keyword">data</span> = dataGetter(index)</span><br><span class="line">            Log.d(<span class="string">&quot;SideDecoration&quot;</span>, <span class="string">&quot;getting data to draw of index <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">            view to <span class="keyword">data</span></span><br><span class="line">        &#125;.map &#123; (view, <span class="keyword">data</span>) -&gt;</span><br><span class="line">            RectF(</span><br><span class="line">                <span class="number">0f</span>,</span><br><span class="line">                view.top + view.translationY,</span><br><span class="line">                padding.toFloat(),</span><br><span class="line">                view.bottom + view.translationY</span><br><span class="line">            ) to <span class="keyword">data</span></span><br><span class="line">        &#125;.forEach &#123; (rect, <span class="keyword">data</span>) -&gt;</span><br><span class="line">            paint.color = <span class="keyword">data</span>?.color ?: <span class="keyword">return</span><span class="symbol">@forEach</span></span><br><span class="line">            c.drawRect(rect, paint)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">        <span class="keyword">val</span> index = parent.getChildAdapterPosition(view)</span><br><span class="line">        Log.d(<span class="string">&quot;SideDecoration&quot;</span>, <span class="string">&quot;getting offset of index <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = dataGetter(index)</span><br><span class="line">        <span class="keyword">data</span>?.let &#123;</span><br><span class="line">            outRect.left = padding</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourFragment</span>: <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, s: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        recycler.addItemDecoration(SideDecoration(view.context, dataList::getOrNull))</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而，运行起来后却会发现，如果进行元素移除操作，被删除元素的方块会在动画开始之前消失，整体效果比贯穿分割线没有动画还更难看。</p>
<h3 id="问题定位"><a href="#问题定位" class="headerlink" title="问题定位"></a>问题定位</h3><p>首先需要来确定，为什么在删除动画开始之前，这个元素的装饰绘制会失效。</p>
<p>梳理一下事件发生顺序：</p>
<ol>
<li>在数据列表中，删除一个数据；</li>
<li>将删除完数据的列表更新到 <code>Adapter</code> 中；</li>
<li><code>RecyclerView</code> 响应数据变化，开始执行动画；</li>
<li><code>ItemDecoration</code> 在动画过程中不停绘制方块；<ol>
<li>根据 <code>view</code> 的位置 <code>getChildAdapterPosition</code> ，通过 <code>dataGetter</code> 在列表中获取数据；</li>
<li>根据获取到的数据判断方块信息；</li>
</ol>
</li>
</ol>
<p>梳理完顺序，应该很快就能发现问题： 在步骤 4.1 中，<code>dataGetter</code> 其实是不可能拿到正确的元素的，只可能有两种情况：</p>
<ul>
<li><code>getChildAdapterPosition</code> 返回了一个不合法的位置，使得 <code>dataGetter</code> 返回了空数据；</li>
<li><code>getChildAdapterPosition</code> 返回了原来的位置，使得 <code>dataGetter</code> 返回了不属于这个卡片的数据。</li>
</ul>
<p>具体情况，可以使用log大法来判断：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SideDecoration</span></span>(context: Context, <span class="keyword">private</span> <span class="keyword">val</span> dataGetter: ((<span class="built_in">Int</span>) -&gt; Data?)) : RecyclerView.ItemDecoration() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paint = Paint()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> padding = context.resources.getDimensionPixelSize(R.dimen.item_side_padding)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(c, parent, state)</span><br><span class="line">        parent.children.map &#123;</span><br><span class="line">            it to parent.getChildAdapterPosition(it)</span><br><span class="line">        &#125;.map &#123; (view, index) -&gt;</span><br><span class="line">            <span class="keyword">val</span> <span class="keyword">data</span> = dataGetter(index)</span><br><span class="line">            Log.d(<span class="string">&quot;SideDecoration&quot;</span>, <span class="string">&quot;getting data to draw of index <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">data</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">                Log.w(</span><br><span class="line">                    <span class="string">&quot;SideDecoration&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Data null!! view data <span class="subst">$&#123;view.findViewById&lt;TextView&gt;(R.id.title).text&#125;</span>&quot;</span></span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            view to <span class="keyword">data</span></span><br><span class="line">        &#125;.map &#123; (view, <span class="keyword">data</span>) -&gt;</span><br><span class="line">            RectF(</span><br><span class="line">                <span class="number">0f</span>,</span><br><span class="line">                view.top + view.translationY,</span><br><span class="line">                padding.toFloat(),</span><br><span class="line">                view.bottom + view.translationY</span><br><span class="line">            ) to <span class="keyword">data</span></span><br><span class="line">        &#125;.forEach &#123; (rect, <span class="keyword">data</span>) -&gt;</span><br><span class="line">            paint.color = <span class="keyword">data</span>?.color ?: <span class="keyword">return</span><span class="symbol">@forEach</span></span><br><span class="line">            c.drawRect(rect, paint)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">        <span class="keyword">val</span> index = parent.getChildAdapterPosition(view)</span><br><span class="line">        Log.d(<span class="string">&quot;SideDecoration&quot;</span>, <span class="string">&quot;getting offset of index <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = dataGetter(index)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">data</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">            Log.w(</span><br><span class="line">                <span class="string">&quot;SideDecoration&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Data null!! view data <span class="subst">$&#123;view.findViewById&lt;TextView&gt;(R.id.title).text&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">data</span>?.let &#123;</span><br><span class="line">            outRect.left = padding</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行后观察log输出：</p>
<blockquote>
<p>D/MainViewModel: Removing data Data(content=db1c87, color=#ff0000ff at 1</p>
<p>D/SideDecoration: getting offset of index -1</p>
<p>W/SideDecoration: Data null!! view data db1c87</p>
<p>…</p>
<p>D/SideDecoration: getting data to draw of index -1</p>
<p>…</p>
<p>W/SideDecoration: Data null!! view data db1c87</p>
<p>…</p>
</blockquote>
<p>可以看出，运行过程中出现了大量 <code>getChildAdapterPosition</code> 返回 -1 的情况，对应的 view 正是被删除数据所绑定的 view 。</p>
<p>查看 <code>getChildAdapterPosition</code> 的源代码，发现其最终都是调用到 <code>androidx.recyclerview.widget.RecyclerView.LayoutParams#getViewAdapterPosition</code> ，其注释如下：</p>
<blockquote>
<p>Returns the up-to-date adapter position that the view this LayoutParams is attached to<br>corresponds to.<br>@return the up-to-date adapter position this view. It may return<br>{@link RecyclerView#NO_POSITION} if item represented by this View has been removed or<br>its up-to-date position cannot be calculated.</p>
</blockquote>
<p>那么，当数据被删除，对应 <code>ViewHolder</code> 被调用 remove 之后，显然就是返回 <code>RecyclerView#NO_POSITION</code> ，即 <code>-1</code> 了。</p>
<p>从另一个角度考虑， <code>ViewHolder</code> 动画是发生在数据删除之后的， <code>dataGetter</code> 本身也不可能在新的数据列表之中找到一个被删除的数据给 <code>ItemDecoration</code> 进行方块绘制。</p>
<h3 id="实现替换"><a href="#实现替换" class="headerlink" title="实现替换"></a>实现替换</h3><p>以上问题的根源在于，数据被移除之后不能找到这个被删除数据提供给 <code>ItemDecoration</code> 进行方块绘制，那么要考虑的解决思路就是如何将 <code>ItemDecoration</code> 所需要的数据传递进去。</p>
<p>回到绘制方法 <code>override fun onDraw(c: Canvas, parent: RecyclerView, state: RecyclerView.State)</code> 中，我们在这里能得到的只有绘制用的画布、 <code>RecyclerView</code> 本身，和他相关联的 <code>state</code> 状态；进一步扩展的话，还能拿到 <code>RecyclerView</code> 当前能展现的子View。</p>
<p>在这里，我们仍然可以考虑将相关的数据存储在 <code>Fragment</code> 或者 <code>ViewModel</code> 中。但是保存已经被删除的数据并不是一个优雅的操作：</p>
<ul>
<li>并且我们也不知道什么时候可以真正地把他们释放；</li>
<li><code>ItemDecoration</code> 也没有合适的 key 去准确获取到对应的数据。</li>
</ul>
<p>因此，还是需要另外寻找存放位置。</p>
<p>考虑到侧边方块是附属于每一个卡片元素的，<code>RecyclerView</code> 本身，和他相关联的 <code>state</code> 状态并不适合存储这些卡片紧密相关的数据，那么一个合理的存储位置就应当是 <code>RecyclerView</code> 当前能展现的子View。</p>
<p>那么如何在一个 <code>View</code> 中存储绘制相关数据呢？一个简单朴素的方法就是使用 <code>android.view.View#setTag(int, java.lang.Object)</code>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SideTagDecoration</span></span>(context: Context) : RecyclerView.ItemDecoration() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paint = Paint()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> padding = context.resources.getDimensionPixelSize(R.dimen.item_side_padding)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(c, parent, state)</span><br><span class="line">        parent.children.map &#123;</span><br><span class="line">            it to it.getTag(R.id.tag_color) <span class="keyword">as</span> <span class="built_in">Int</span></span><br><span class="line">        &#125;.map &#123; (view, color) -&gt;</span><br><span class="line">            RectF(</span><br><span class="line">                <span class="number">0f</span>,</span><br><span class="line">                view.top + view.translationY,</span><br><span class="line">                padding.toFloat(),</span><br><span class="line">                view.bottom + view.translationY</span><br><span class="line">            ) to ColorUtils.setAlphaComponent(color, (view.alpha * <span class="number">255</span>).toInt())</span><br><span class="line">        &#125;.forEach &#123; (rect, color) -&gt;</span><br><span class="line">            paint.color = color</span><br><span class="line">            c.drawRect(rect, paint)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">        <span class="keyword">val</span> content = view.getTag(R.id.tag_content) <span class="keyword">as</span> String</span><br><span class="line">        <span class="keyword">if</span> (content.isNotBlank()) &#123;</span><br><span class="line">            outRect.left = padding</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个 <code>ItemDecoration</code> 的绘制过程中，我们读取了 <code>ItemView</code> 里设置的颜色信息，那么就需要在合适的地方设置进去，这里就需要 <code>ViewHolder</code> 的协助了：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span></span>(parent: ViewGroup) : RecyclerView.ViewHolder(</span><br><span class="line">    LayoutInflater.from(parent.context).inflate(R.layout.rv_item_layout, parent, <span class="literal">false</span>)</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bindings = RvItemLayoutBinding.bind(itemView)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">bind</span><span class="params">(<span class="keyword">data</span>: <span class="type">Data</span>)</span></span> &#123;</span><br><span class="line">        bindings.root.setTag(R.id.tag_color, <span class="keyword">data</span>.color)</span><br><span class="line">        bindings.root.setTag(R.id.tag_content, <span class="keyword">data</span>.content)</span><br><span class="line">        bindings.title.text = <span class="keyword">data</span>.content</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这一套实现方案中，我们仅仅将 <code>ItemDecoration</code> 所需要的颜色数据存入 <code>itemView</code> 的 tag 数据中，保证了额外数据的最小化； <code>ItemDecoration</code> 也实现了获取已经被删除的数据（以及正常存在数据）的获取，还节省了一个 lambda 表达式的传入，有着还不错的表现。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在平时的开发中，我其实挺少使用 <code>View.setTag</code> 方法，认为这个东西比较古老，还可能容易引起内存问题；但是在这个场景下，合理的使用 <code>setTag</code> 其实很能快速地解决我们的问题。</p>
<p>示例项目已经在 Github 上开源：<a target="_blank" rel="noopener" href="https://github.com/xiaozhikang0916/Recyclerview-ani">Recyclerview-ani 项目地址</a>。</p>
<p>可以在侧边栏中分别进入普通实现版本 (<code>Common Decoration</code>) 和 Tag 实现版本 (<code>Tag Decoration</code>) ，点击 <code>ADD</code> <code>REMOVE</code> 按钮观察其表现。</p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>本文标题：</span>RecyclerView 中为 ItemDecoration 应用动画</p><p><span>文章作者：</span>Xiao</p><p><span>发布时间：</span>2021-03-09</p><p><span>最后更新：</span>2023-01-17</p><p><span>原始链接：</span><a href="/blog/recycler-animate-decoration/">https://blog.xiaozk.site/blog/recycler-animate-decoration/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://blog.xiaozk.site/blog/recycler-animate-decoration/"></i></span></p><p><span>版权声明：</span><a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议（CC-BY-NC-4.0）</a>进行许可。</a></p></div><br><div class="tags"><a href="/tags/Android/"><i class="fa fa-tag"></i>Android</a><a href="/tags/RecyclerView/"><i class="fa fa-tag"></i>RecyclerView</a><a href="/tags/ItemDecoration/"><i class="fa fa-tag"></i>ItemDecoration</a><a href="/tags/Animation/"><i class="fa fa-tag"></i>Animation</a></div><div class="post-nav"><a class="pre" href="/blog/coroutine-task/">使用协程组合管理业务逻辑</a><a class="next" href="/blog/recycler-animator-click/">RecyclerView 的 item 在动画过程中的点击事件</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://blog.xiaozk.site"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/RecyclerView/" style="font-size: 15px;">RecyclerView</a> <a href="/tags/Callback/" style="font-size: 15px;">Callback</a> <a href="/tags/kotlin/" style="font-size: 15px;">kotlin</a> <a href="/tags/forEach/" style="font-size: 15px;">forEach</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/stream/" style="font-size: 15px;">stream</a> <a href="/tags/ItemTouchHelper/" style="font-size: 15px;">ItemTouchHelper</a> <a href="/tags/Unittest/" style="font-size: 15px;">Unittest</a> <a href="/tags/Powermock/" style="font-size: 15px;">Powermock</a> <a href="/tags/mock-rule/" style="font-size: 15px;">mock rule</a> <a href="/tags/RuleChain/" style="font-size: 15px;">RuleChain</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Constructor/" style="font-size: 15px;">Constructor</a> <a href="/tags/MVVM/" style="font-size: 15px;">MVVM</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/xml/" style="font-size: 15px;">xml</a> <a href="/tags/layout/" style="font-size: 15px;">layout</a> <a href="/tags/drawable/" style="font-size: 15px;">drawable</a> <a href="/tags/color/" style="font-size: 15px;">color</a> <a href="/tags/selector/" style="font-size: 15px;">selector</a> <a href="/tags/ItemAnimator/" style="font-size: 15px;">ItemAnimator</a> <a href="/tags/coroutine/" style="font-size: 15px;">coroutine</a> <a href="/tags/%E5%AE%89%E5%8D%93/" style="font-size: 15px;">安卓</a> <a href="/tags/%E5%8D%8F%E7%A8%8B/" style="font-size: 15px;">协程</a> <a href="/tags/RenderNode/" style="font-size: 15px;">RenderNode</a> <a href="/tags/Canvas/" style="font-size: 15px;">Canvas</a> <a href="/tags/ItemDecoration/" style="font-size: 15px;">ItemDecoration</a> <a href="/tags/Animation/" style="font-size: 15px;">Animation</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/android-render-node/">在 Android 中使用 Render Node 加速渲染</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/coroutine-task/">使用协程组合管理业务逻辑</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/recycler-animate-decoration/">RecyclerView 中为 ItemDecoration 应用动画</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/recycler-animator-click/">RecyclerView 的 item 在动画过程中的点击事件</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-drawable-color-selector/">Android xml 中 drawable、color 的混用与 selector</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/kotlin-lambda-param/">kotlin 中传入形参、返回不匹配的 lambda 表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/thoughts-of-android-mvvm/">Android 项目中使用 MVVM 模式的一些思考</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/java-override-constructor/">java 构造方法的重载</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/android-test-rule-order/">Android 使用Powermock的单元测试的 Rule 顺序</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/item-touch-helper-section/">ItemTouchHelper实现拖动分组与定制</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">Xiao's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>